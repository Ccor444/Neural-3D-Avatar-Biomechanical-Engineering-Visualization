<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Neural 3D Avatar Viewer - Advanced Mesh Visualization</title>
    <link rel="stylesheet" href="styles.css">
    
    <!-- Three.js and dependencies -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tween.js/18.6.4/tween.umd.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/stats.js/r17/Stats.min.js"></script>
    
    <!-- Favicon -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üß†</text></svg>">
    
    <!-- Preload critical resources -->
    <link rel="preload" href="mesh_data.json" as="fetch" crossorigin="anonymous">
</head>
<body>
    <div class="app-container">
        <!-- Top Navigation -->
        <nav class="top-nav">
            <div class="nav-brand">
                <div class="brand-icon">üß†</div>
                <div class="brand-text">
                    <h1>Neural 3D Avatar</h1>
                    <p class="subtitle">High Precision Biomechanical Mesh</p>
                </div>
            </div>
            
            <div class="nav-controls">
                <div class="control-group">
                    <span class="control-label">FPS:</span>
                    <span id="fps-counter" class="control-value">60</span>
                </div>
                <div class="control-group">
                    <span class="control-label">Triangles:</span>
                    <span id="triangle-counter" class="control-value">0</span>
                </div>
                <button id="performance-btn" class="nav-btn" title="Toggle Performance Stats (F4)">
                    <span class="btn-icon">‚ö°</span>
                    Performance
                </button>
                <button id="help-btn" class="nav-btn" title="Show Keyboard Shortcuts (F1)">
                    <span class="btn-icon">‚ùì</span>
                    Help
                </button>
            </div>
        </nav>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Left Panel - Visualization Controls -->
            <aside class="left-panel">
                <div class="panel-section">
                    <h3 class="section-title">
                        <span class="icon">üëÅÔ∏è</span>
                        Visualization
                    </h3>
                    
                    <div class="control-grid">
                        <div class="control-item">
                            <label for="render-mode">Render Mode</label>
                            <select id="render-mode" class="control-select">
                                <option value="wireframe">Wireframe</option>
                                <option value="points">Point Cloud</option>
                                <option value="solid">Solid</option>
                                <option value="combined" selected>Combined</option>
                            </select>
                        </div>
                        
                        <div class="control-item">
                            <label for="lod-level">LOD Level</label>
                            <select id="lod-level" class="control-select">
                                <option value="high">High (100%)</option>
                                <option value="medium" selected>Medium (70%)</option>
                                <option value="low">Low (40%)</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="slider-group">
                        <label for="opacity-slider">
                            Opacity: <span id="opacity-value">80%</span>
                        </label>
                        <input type="range" id="opacity-slider" min="10" max="100" value="80" class="slider">
                    </div>
                    
                    <div class="slider-group">
                        <label for="glow-slider">
                            Glow Intensity: <span id="glow-value">70%</span>
                        </label>
                        <input type="range" id="glow-slider" min="0" max="100" value="70" class="slider">
                    </div>
                </div>

                <div class="panel-section">
                    <h3 class="section-title">
                        <span class="icon">üî¨</span>
                        Mesh Analysis
                    </h3>
                    
                    <div class="toggle-group">
                        <div class="toggle-item">
                            <input type="checkbox" id="show-joints" checked>
                            <label for="show-joints">Show Joints</label>
                        </div>
                        <div class="toggle-item">
                            <input type="checkbox" id="show-skeleton" checked>
                            <label for="show-skeleton">Show Skeleton</label>
                        </div>
                        <div class="toggle-item">
                            <input type="checkbox" id="show-wireframe" checked>
                            <label for="show-wireframe">Show Wireframe</label>
                        </div>
                        <div class="toggle-item">
                            <input type="checkbox" id="show-surface">
                            <label for="show-surface">Show Surface</label>
                        </div>
                    </div>
                    
                    <div class="color-picker-group">
                        <label>Color Mapping:</label>
                        <div class="color-options">
                            <button class="color-option active" data-color="biomechanical">Biomechanical</button>
                            <button class="color-option" data-color="thermal">Thermal</button>
                            <button class="color-option" data-color="group">Group</button>
                            <button class="color-option" data-color="weight">Weight</button>
                        </div>
                    </div>
                </div>

                <div class="panel-section">
                    <h3 class="section-title">
                        <span class="icon">‚öôÔ∏è</span>
                        Physics & Animation
                    </h3>
                    
                    <div class="toggle-group">
                        <div class="toggle-item">
                            <input type="checkbox" id="enable-physics">
                            <label for="enable-physics">Enable Physics (P)</label>
                        </div>
                        <div class="toggle-item">
                            <input type="checkbox" id="enable-ik">
                            <label for="enable-ik">Inverse Kinematics</label>
                        </div>
                    </div>
                    
                    <div class="slider-group">
                        <label for="gravity-slider">
                            Gravity: <span id="gravity-value">9.8</span> m/s¬≤
                        </label>
                        <input type="range" id="gravity-slider" min="0" max="20" step="0.1" value="9.8" class="slider">
                    </div>
                    
                    <div class="pose-selector">
                        <label>Animation Pose:</label>
                        <div class="pose-buttons">
                            <button class="pose-btn active" data-pose="t-pose">T-Pose</button>
                            <button class="pose-btn" data-pose="idle">Idle</button>
                            <button class="pose-btn" data-pose="walking">Walking</button>
                        </div>
                    </div>
                    
                    <div class="button-group">
                        <button id="reset-physics" class="action-btn" title="Reset Physics Simulation (R)">
                            <span class="btn-icon">üîÑ</span>
                            Reset Physics
                        </button>
                        <button id="export-btn" class="action-btn secondary" title="Export Current State">
                            <span class="btn-icon">üíæ</span>
                            Export
                        </button>
                    </div>
                </div>

                <div class="panel-section">
                    <h3 class="section-title">
                        <span class="icon">üìä</span>
                        Statistics
                    </h3>
                    
                    <div class="stats-grid">
                        <div class="stat-item">
                            <div class="stat-label">Vertices</div>
                            <div class="stat-value" id="stat-vertices">0</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">Edges</div>
                            <div class="stat-value" id="stat-edges">0</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">Groups</div>
                            <div class="stat-value" id="stat-groups">0</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">Joints</div>
                            <div class="stat-value" id="stat-joints">0</div>
                        </div>
                    </div>
                </div>
            </aside>

            <!-- Main 3D Viewer -->
            <main class="viewer-container">
                <div id="canvas-container">
                    <canvas id="mesh-canvas"></canvas>
                    <div class="viewer-overlay">
                        <div class="viewer-controls">
                            <button id="reset-view" class="viewer-btn" title="Reset View (Spacebar)">
                                <span class="btn-icon">üîÑ</span>
                            </button>
                            <button id="toggle-grid" class="viewer-btn" title="Toggle Grid (G)">
                                <span class="btn-icon">‚èπÔ∏è</span>
                            </button>
                            <button id="toggle-axis" class="viewer-btn" title="Toggle Axis (X)">
                                <span class="btn-icon">üß≠</span>
                            </button>
                            <button id="screenshot" class="viewer-btn" title="Take Screenshot (S)">
                                <span class="btn-icon">üì∏</span>
                            </button>
                            <button id="toggle-panel" class="viewer-btn mobile-only" title="Toggle Control Panel">
                                <span class="btn-icon">‚öôÔ∏è</span>
                            </button>
                        </div>
                        <div class="coordinate-display">
                            <div>X: <span id="coord-x">0.00</span></div>
                            <div>Y: <span id="coord-y">0.00</span></div>
                            <div>Z: <span id="coord-z">0.00</span></div>
                        </div>
                    </div>
                    
                    <!-- Controls hint -->
                    <div class="controls-hint">
                        <div class="hint-item">
                            <kbd>LMB</kbd> + Drag: Rotate
                        </div>
                        <div class="hint-item">
                            <kbd>RMB</kbd> + Drag: Pan
                        </div>
                        <div class="hint-item">
                            <kbd>Scroll</kbd>: Zoom
                        </div>
                        <div class="hint-item">
                            <kbd>Click</kbd>: Select Vertex
                        </div>
                    </div>
                </div>
                
                <!-- Vertex Info Panel -->
                <div class="vertex-info-panel" id="vertex-info">
                    <div class="panel-header">
                        <h4>Vertex Details</h4>
                        <button class="close-btn" id="close-vertex-info" title="Close (ESC)">√ó</button>
                    </div>
                    <div class="panel-content">
                        <div class="vertex-id" id="vertex-id">head_top</div>
                        <div class="vertex-details">
                            <div class="detail-row">
                                <span class="detail-label">Group:</span>
                                <span class="detail-value" id="vertex-group">head</span>
                            </div>
                            <div class="detail-row">
                                <span class="detail-label">Type:</span>
                                <span class="detail-value" id="vertex-type">joint</span>
                            </div>
                            <div class="detail-row">
                                <span class="detail-label">Weight:</span>
                                <span class="detail-value" id="vertex-weight">0.8</span>
                            </div>
                            <div class="detail-row">
                                <span class="detail-label">Position:</span>
                                <span class="detail-value" id="vertex-position">[0, -72, 0]</span>
                            </div>
                            <div class="detail-row">
                                <span class="detail-label">Status:</span>
                                <span class="detail-value" id="vertex-status">Fixed</span>
                            </div>
                        </div>
                        <div class="vertex-actions">
                            <button id="toggle-fixed" class="action-btn small" title="Toggle Fixed State">
                                <span class="btn-icon">üìå</span>
                                Toggle Fixed
                            </button>
                            <button id="apply-force" class="action-btn small secondary" title="Apply Random Force">
                                <span class="btn-icon">üí®</span>
                                Apply Force
                            </button>
                        </div>
                        <div class="vertex-connections">
                            <h5>Connected Vertices:</h5>
                            <div class="connections-list" id="connections-list">
                                <!-- Connections will be populated here -->
                            </div>
                        </div>
                    </div>
                </div>
            </main>

            <!-- Right Panel - Data Explorer -->
            <aside class="right-panel">
                <div class="panel-section">
                    <h3 class="section-title">
                        <span class="icon">üóÇÔ∏è</span>
                        Data Explorer
                    </h3>
                    
                    <div class="search-box">
                        <input type="text" id="vertex-search" placeholder="Search vertices..." autocomplete="off">
                        <span class="search-icon">üîç</span>
                    </div>
                    
                    <div class="data-tabs">
                        <button class="tab-btn active" data-tab="vertices">Vertices</button>
                        <button class="tab-btn" data-tab="edges">Edges</button>
                        <button class="tab-btn" data-tab="groups">Groups</button>
                    </div>
                    
                    <div class="data-list" id="vertices-list">
                        <!-- Vertices will be populated here -->
                        <div class="data-placeholder">
                            Loading vertices...
                        </div>
                    </div>
                    
                    <div class="data-list" id="edges-list" style="display: none;">
                        <!-- Edges will be populated here -->
                        <div class="data-placeholder">
                            Loading edges...
                        </div>
                    </div>
                    
                    <div class="data-list" id="groups-list" style="display: none;">
                        <!-- Groups will be populated here -->
                        <div class="data-placeholder">
                            Loading groups...
                        </div>
                    </div>
                </div>

                <div class="panel-section">
                    <h3 class="section-title">
                        <span class="icon">üìà</span>
                        Real-time Metrics
                    </h3>
                    
                    <div class="metrics-container">
                        <div class="metric">
                            <div class="metric-label">CPU Usage</div>
                            <div class="metric-bar">
                                <div class="metric-fill" id="cpu-bar" style="width: 45%"></div>
                            </div>
                            <div class="metric-value" id="cpu-value">45%</div>
                        </div>
                        
                        <div class="metric">
                            <div class="metric-label">GPU Memory</div>
                            <div class="metric-bar">
                                <div class="metric-fill" id="gpu-bar" style="width: 60%"></div>
                            </div>
                            <div class="metric-value" id="gpu-value">60%</div>
                        </div>
                        
                        <div class="metric">
                            <div class="metric-label">Frame Time</div>
                            <div class="metric-bar">
                                <div class="metric-fill" id="frame-bar" style="width: 30%"></div>
                            </div>
                            <div class="metric-value" id="frame-value">16ms</div>
                        </div>
                    </div>
                    
                    <div class="physics-stats">
                        <div class="stat-row">
                            <span class="stat-label">Physics:</span>
                            <span class="stat-value" id="physics-status">Disabled</span>
                        </div>
                        <div class="stat-row">
                            <span class="stat-label">Gravity:</span>
                            <span class="stat-value" id="physics-gravity">9.8 m/s¬≤</span>
                        </div>
                        <div class="stat-row">
                            <span class="stat-label">Springs:</span>
                            <span class="stat-value" id="physics-springs">0</span>
                        </div>
                    </div>
                </div>

                <div class="panel-section">
                    <h3 class="section-title">
                        <span class="icon">üéÆ</span>
                        Camera Controls
                    </h3>
                    
                    <div class="camera-controls">
                        <div class="camera-presets">
                            <button class="camera-btn" data-view="front" title="Front View (1)">Front</button>
                            <button class="camera-btn" data-view="side" title="Side View (2)">Side</button>
                            <button class="camera-btn" data-view="top" title="Top View (3)">Top</button>
                            <button class="camera-btn" data-view="perspective" title="3D View">3D</button>
                        </div>
                        
                        <div class="camera-sliders">
                            <div class="slider-group">
                                <label for="camera-zoom">Zoom</label>
                                <input type="range" id="camera-zoom" min="50" max="500" value="200" class="slider">
                            </div>
                            
                            <div class="slider-group">
                                <label for="camera-rotation">Rotation Speed</label>
                                <input type="range" id="camera-rotation" min="0.1" max="2" step="0.1" value="1" class="slider">
                            </div>
                        </div>
                    </div>
                </div>

                <div class="panel-section">
                    <h3 class="section-title">
                        <span class="icon">üéØ</span>
                        Quick Actions
                    </h3>
                    
                    <div class="quick-actions">
                        <button id="simulate-wind" class="quick-btn">
                            <span class="btn-icon">üí®</span>
                            Wind
                        </button>
                        <button id="simulate-explosion" class="quick-btn">
                            <span class="btn-icon">üí•</span>
                            Explosion
                        </button>
                        <button id="toggle-wireframe" class="quick-btn">
                            <span class="btn-icon">üî≤</span>
                            Wireframe
                        </button>
                        <button id="toggle-help" class="quick-btn">
                            <span class="btn-icon">‚ùì</span>
                            Help
                        </button>
                    </div>
                </div>
            </aside>
        </div>

        <!-- Bottom Status Bar -->
        <footer class="status-bar">
            <div class="status-left">
                <span class="status-indicator active" id="connection-status"></span>
                <span class="status-text" id="connection-text">Connected to Mesh Data</span>
                <span class="status-data" id="data-source">mesh_data.json</span>
            </div>
            
            <div class="status-center">
                <span class="status-icon">üìê</span>
                <span class="status-text" id="bounding-box">Bounding Box: [-35, -100, -10] to [35, 100, 10]</span>
            </div>
            
            <div class="status-right">
                <span class="status-icon">üß†</span>
                <span class="status-text">Neural Systems Lab | Version 2.0.0</span>
                <span class="status-hotkey" title="Keyboard Shortcuts">[F1]</span>
            </div>
        </footer>
    </div>

    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loading-overlay">
        <div class="loading-content">
            <div class="loading-spinner"></div>
            <div class="loading-text">Initializing Neural 3D Mesh Viewer...</div>
            <div class="loading-progress">
                <div class="progress-bar">
                    <div class="progress-fill" id="progress-fill"></div>
                </div>
                <span class="progress-text" id="progress-text">0%</span>
            </div>
            <div class="loading-details" id="loading-details"></div>
            <div class="loading-hotkeys">
                <div class="hotkey-item">Spacebar: Reset View</div>
                <div class="hotkey-item">1,2,3: Camera Views</div>
                <div class="hotkey-item">P: Toggle Physics</div>
                <div class="hotkey-item">ESC: Close Panels</div>
            </div>
        </div>
    </div>

    <!-- Help Modal -->
    <div class="modal-overlay" id="help-modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Keyboard Shortcuts & Help</h3>
                <button class="close-btn" id="close-help">√ó</button>
            </div>
            <div class="modal-body">
                <div class="shortcuts-grid">
                    <div class="shortcut-category">
                        <h4>Camera Controls</h4>
                        <div class="shortcut-item">
                            <kbd>LMB</kbd> + Drag: Rotate View
                        </div>
                        <div class="shortcut-item">
                            <kbd>RMB</kbd> + Drag: Pan View
                        </div>
                        <div class="shortcut-item">
                            <kbd>Scroll</kbd>: Zoom In/Out
                        </div>
                        <div class="shortcut-item">
                            <kbd>Space</kbd>: Reset View
                        </div>
                        <div class="shortcut-item">
                            <kbd>1</kbd>: Front View
                        </div>
                        <div class="shortcut-item">
                            <kbd>2</kbd>: Side View
                        </div>
                        <div class="shortcut-item">
                            <kbd>3</kbd>: Top View
                        </div>
                    </div>
                    
                    <div class="shortcut-category">
                        <h4>Physics Simulation</h4>
                        <div class="shortcut-item">
                            <kbd>P</kbd>: Toggle Physics
                        </div>
                        <div class="shortcut-item">
                            <kbd>R</kbd>: Reset Physics
                        </div>
                        <div class="shortcut-item">
                            <kbd>G</kbd>: Toggle Grid
                        </div>
                        <div class="shortcut-item">
                            <kbd>X</kbd>: Toggle Axes
                        </div>
                    </div>
                    
                    <div class="shortcut-category">
                        <h4>Interaction</h4>
                        <div class="shortcut-item">
                            <kbd>Click</kbd>: Select Vertex
                        </div>
                        <div class="shortcut-item">
                            <kbd>ESC</kbd>: Close Panels
                        </div>
                        <div class="shortcut-item">
                            <kbd>S</kbd>: Screenshot
                        </div>
                        <div class="shortcut-item">
                            <kbd>F4</kbd>: Performance Stats
                        </div>
                        <div class="shortcut-item">
                            <kbd>F1</kbd>: Show Help
                        </div>
                    </div>
                </div>
                
                <div class="help-section">
                    <h4>About This Application</h4>
                    <p>This is an advanced biomechanical mesh visualizer that simulates human tissue behavior using mass-spring physics. The system implements anatomical joint constraints for medical, robotic, and sports science applications.</p>
                </div>
                
                <div class="help-section">
                    <h4>Tips</h4>
                    <ul>
                        <li>Click on joints to view detailed information</li>
                        <li>Enable physics to see realistic tissue simulation</li>
                        <li>Use different color mappings to analyze weight distribution</li>
                        <li>Adjust gravity and stiffness for different simulation scenarios</li>
                    </ul>
                </div>
            </div>
            <div class="modal-footer">
                <button id="close-help-btn" class="modal-btn primary">Close</button>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="meshRenderer.js"></script>
    <script src="physicsEngine.js"></script>
    <script src="uiController.js"></script>
    <script src="app.js"></script>
    
    <!-- Inline script for immediate functionality -->
    <script>
        // Prevent context menu on canvas
        document.addEventListener('contextmenu', function(e) {
            if (e.target.id === 'mesh-canvas' || e.target.closest('#canvas-container')) {
                e.preventDefault();
            }
        });

        // Add CSS for new elements
        const additionalStyles = document.createElement('style');
        additionalStyles.textContent = `
            /* Button Group */
            .button-group {
                display: flex;
                gap: 10px;
                margin-top: 15px;
            }
            
            .action-btn {
                flex: 1;
                padding: 10px;
                background: var(--primary-color);
                color: white;
                border: none;
                border-radius: var(--border-radius);
                font-size: 12px;
                cursor: pointer;
                transition: all var(--transition-speed);
                display: flex;
                align-items: center;
                justify-content: center;
                gap: 8px;
            }
            
            .action-btn:hover {
                background: var(--secondary-color);
                transform: translateY(-2px);
            }
            
            .action-btn.secondary {
                background: var(--background-light);
                color: var(--text-primary);
            }
            
            .action-btn.secondary:hover {
                background: var(--background-medium);
            }
            
            .action-btn.small {
                padding: 6px 10px;
                font-size: 11px;
            }
            
            /* Vertex Actions */
            .vertex-actions {
                display: flex;
                gap: 10px;
                margin: 15px 0;
            }
            
            /* Controls Hint */
            .controls-hint {
                position: absolute;
                bottom: 60px;
                left: 20px;
                background: rgba(17, 34, 64, 0.8);
                padding: 10px;
                border-radius: var(--border-radius);
                font-size: 11px;
                color: var(--text-secondary);
                backdrop-filter: blur(10px);
                border: 1px solid var(--background-light);
                display: flex;
                gap: 15px;
            }
            
            .hint-item {
                display: flex;
                align-items: center;
                gap: 5px;
            }
            
            .hint-item kbd {
                background: var(--background-light);
                padding: 2px 6px;
                border-radius: 4px;
                font-size: 10px;
                font-family: monospace;
                border: 1px solid var(--primary-color);
            }
            
            /* Physics Stats */
            .physics-stats {
                margin-top: 15px;
                padding-top: 15px;
                border-top: 1px solid var(--background-light);
            }
            
            .stat-row {
                display: flex;
                justify-content: space-between;
                margin-bottom: 8px;
                font-size: 12px;
            }
            
            .stat-row .stat-label {
                color: var(--text-secondary);
            }
            
            .stat-row .stat-value {
                color: var(--text-primary);
                font-weight: 500;
            }
            
            /* Quick Actions */
            .quick-actions {
                display: grid;
                grid-template-columns: repeat(2, 1fr);
                gap: 10px;
            }
            
            .quick-btn {
                padding: 10px;
                background: var(--background-light);
                border: 1px solid var(--background-light);
                border-radius: var(--border-radius);
                color: var(--text-primary);
                font-size: 12px;
                cursor: pointer;
                transition: all var(--transition-speed);
                display: flex;
                flex-direction: column;
                align-items: center;
                gap: 5px;
            }
            
            .quick-btn:hover {
                border-color: var(--primary-color);
                background: var(--background-medium);
            }
            
            /* Data Placeholder */
            .data-placeholder {
                text-align: center;
                padding: 20px;
                color: var(--text-secondary);
                font-style: italic;
            }
            
            /* Status Hotkey */
            .status-hotkey {
                margin-left: 10px;
                padding: 2px 6px;
                background: var(--background-light);
                border-radius: 4px;
                font-size: 11px;
                font-family: monospace;
            }
            
            /* Loading Hotkeys */
            .loading-hotkeys {
                margin-top: 30px;
                display: flex;
                gap: 20px;
                flex-wrap: wrap;
                justify-content: center;
            }
            
            .hotkey-item {
                font-size: 12px;
                color: var(--text-secondary);
                padding: 5px 10px;
                background: rgba(46, 163, 255, 0.1);
                border-radius: 4px;
            }
            
            /* Modal */
            .modal-overlay {
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(5, 10, 20, 0.95);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 10000;
                backdrop-filter: blur(10px);
            }
            
            .modal-content {
                background: var(--background-medium);
                border-radius: var(--border-radius);
                width: 90%;
                max-width: 800px;
                max-height: 80vh;
                overflow-y: auto;
                border: 1px solid var(--background-light);
            }
            
            .modal-header {
                padding: 20px;
                border-bottom: 1px solid var(--background-light);
                display: flex;
                justify-content: space-between;
                align-items: center;
            }
            
            .modal-header h3 {
                color: var(--text-primary);
            }
            
            .modal-body {
                padding: 20px;
            }
            
            .modal-footer {
                padding: 20px;
                border-top: 1px solid var(--background-light);
                text-align: right;
            }
            
            .modal-btn {
                padding: 10px 20px;
                background: var(--primary-color);
                color: white;
                border: none;
                border-radius: var(--border-radius);
                cursor: pointer;
                font-size: 14px;
            }
            
            .modal-btn.primary {
                background: var(--primary-color);
            }
            
            .modal-btn.primary:hover {
                background: var(--secondary-color);
            }
            
            /* Shortcuts Grid */
            .shortcuts-grid {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
                gap: 20px;
                margin-bottom: 30px;
            }
            
            .shortcut-category h4 {
                color: var(--primary-color);
                margin-bottom: 15px;
                padding-bottom: 8px;
                border-bottom: 1px solid var(--background-light);
            }
            
            .shortcut-item {
                margin-bottom: 10px;
                font-size: 14px;
                color: var(--text-primary);
            }
            
            .shortcut-item kbd {
                background: var(--background-light);
                padding: 2px 8px;
                border-radius: 4px;
                font-family: monospace;
                border: 1px solid var(--primary-color);
                margin-right: 8px;
            }
            
            /* Help Section */
            .help-section {
                margin-bottom: 25px;
            }
            
            .help-section h4 {
                color: var(--primary-color);
                margin-bottom: 10px;
            }
            
            .help-section p, .help-section ul {
                color: var(--text-secondary);
                line-height: 1.6;
            }
            
            .help-section ul {
                padding-left: 20px;
            }
            
            .help-section li {
                margin-bottom: 8px;
            }
            
            /* Mobile only */
            .mobile-only {
                display: none;
            }
            
            @media (max-width: 768px) {
                .mobile-only {
                    display: flex;
                }
                
                .controls-hint {
                    flex-direction: column;
                    gap: 8px;
                    bottom: 100px;
                }
            }
        `;
        document.head.appendChild(additionalStyles);
        
        // Help modal functionality
        document.addEventListener('DOMContentLoaded', function() {
            const helpModal = document.getElementById('help-modal');
            const helpBtn = document.getElementById('help-btn');
            const toggleHelpBtn = document.getElementById('toggle-help');
            const closeHelpBtns = document.querySelectorAll('#close-help, #close-help-btn');
            
            function showHelp() {
                if (helpModal) {
                    helpModal.style.display = 'flex';
                }
            }
            
            function hideHelp() {
                if (helpModal) {
                    helpModal.style.display = 'none';
                }
            }
            
            if (helpBtn) {
                helpBtn.addEventListener('click', showHelp);
            }
            
            if (toggleHelpBtn) {
                toggleHelpBtn.addEventListener('click', showHelp);
            }
            
            closeHelpBtns.forEach(btn => {
                if (btn) {
                    btn.addEventListener('click', hideHelp);
                }
            });
            
            // Close modal on ESC
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape' && helpModal.style.display === 'flex') {
                    hideHelp();
                }
                if (e.key === 'F1') {
                    e.preventDefault();
                    showHelp();
                }
            });
            
            // Close modal on overlay click
            if (helpModal) {
                helpModal.addEventListener('click', function(e) {
                    if (e.target === helpModal) {
                        hideHelp();
                    }
                });
            }
        });
    </script>
</body>
</html>